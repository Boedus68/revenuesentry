<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - RevenueSentry</title>

    <!-- Script di Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font "Inter" da Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Stili Personalizzati -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        /* Stile per la scrollbar (opzionale, per estetica) */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }
        
        /* Animazione per il messaggio di salvataggio */
        .toast-enter {
            opacity: 0;
            transform: translateY(20px);
        }
        .toast-enter-active {
            opacity: 1;
            transform: translateY(0);
            transition: opacity 300ms, transform 300ms;
        }
        .toast-exit {
            opacity: 1;
            transform: translateY(0);
        }
        .toast-exit-active {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 300ms, transform 300ms;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200">

    <!-- Schermata di caricamento -->
    <div id="loader" class="fixed inset-0 bg-gray-900 flex items-center justify-center z-50">
        <svg class="animate-spin h-8 w-8 text-blue-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
    </div>

    <!-- Struttura della Dashboard (inizialmente nascosta) -->
    <div id="dashboard-content" class="hidden h-screen flex">
        
        <!-- Sidebar di Navigazione -->
        <aside class="w-64 bg-gray-800/50 border-r border-gray-700 flex-shrink-0 flex flex-col">
            <!-- Logo -->
            <div class="h-16 flex items-center justify-center border-b border-gray-700">
                 <a href="index.html" class="text-2xl font-bold text-white">
                    Revenue<span class="text-blue-400">Sentry</span>
                </a>
            </div>
            <!-- Menu -->
            <nav class="flex-1 px-4 py-6 space-y-2">
                <a href="#" id="nav-panoramica" class="nav-link flex items-center px-4 py-2 text-base font-semibold text-gray-400 hover:bg-gray-700/50 hover:text-white rounded-lg transition">
                    <svg class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
                    Panoramica
                </a>
                <a href="#" id="nav-costi" class="nav-link flex items-center px-4 py-2 text-base font-semibold bg-blue-500/20 text-blue-300 rounded-lg">
                    <svg class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2a4 4 0 00-4-4H3V9h2a4 4 0 004-4V3l4 4-4 4zM15 17v-2a4 4 0 014-4h2V9h-2a4 4 0 01-4-4V3l-4 4 4 4z"/></svg>
                    Costi
                </a>
                <a href="#" id="nav-report" class="nav-link flex items-center px-4 py-2 text-base font-semibold text-gray-400 hover:bg-gray-700/50 hover:text-white rounded-lg transition">
                     <svg class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"></path></svg>
                    Report
                </a>
            </nav>
        </aside>

        <!-- Contenuto Principale -->
        <main class="flex-1 flex flex-col">
            <!-- Header -->
            <header class="h-16 bg-gray-800/30 border-b border-gray-700 flex items-center justify-between px-6 flex-shrink-0">
                <h1 id="hotel-name-display" class="text-xl font-semibold text-white">Caricamento...</h1>
                <button id="logout-button" class="bg-red-600/80 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg text-sm transition">
                    Logout
                </button>
            </header>

            <!-- Area Contenuti -->
            <div class="flex-1 p-8 overflow-y-auto">

                <!-- Sezione Panoramica (Nascosta) -->
                <div id="content-panoramica" class="hidden">
                    <h2 class="text-3xl font-bold text-white mb-6">Panoramica Generale</h2>
                    <div class="bg-gray-800/50 border border-gray-700 rounded-2xl p-8 text-center">
                        <p class="text-gray-400">Questa sezione è in costruzione. A breve qui potrai visualizzare i grafici e le analisi principali.</p>
                    </div>
                </div>

                <!-- Sezione Costi (Visibile di default) -->
                <div id="content-costi">
                    <form id="costs-form">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-3xl font-bold text-white">Inserimento Costi Mensili</h2>
                            <button type="submit" id="save-button" class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-2 px-6 rounded-lg transition">
                                Salva Modifiche
                            </button>
                        </div>
    
                        <!-- Sezione Ristorazione -->
                        <div class="bg-gray-800/50 border border-gray-700 rounded-2xl p-6 mb-6">
                            <h3 class="text-xl font-semibold text-white mb-4">Ristorazione</h3>
                            <div id="ristorazione-fields" class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                                <!-- Campi generati da JS -->
                            </div>
                        </div>
    
                        <!-- Griglia per altre sezioni -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            
                            <!-- Sezione Utenze -->
                            <div class="bg-gray-800/50 border border-gray-700 rounded-2xl p-6">
                                <h3 class="text-xl font-semibold text-white mb-4">Utenze</h3>
                                <div class="space-y-4">
                                    <!-- Energia Elettrica -->
                                    <div class="grid grid-cols-2 gap-4 items-end">
                                        <input type="text" id="cost-energia-fornitore" placeholder="Fornitore Energia Elettrica" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                                        <input type="number" step="0.01" id="cost-energia-importo" placeholder="Importo €" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                                    </div>
                                    <!-- Gas -->
                                    <div class="grid grid-cols-2 gap-4 items-end">
                                        <input type="text" id="cost-gas-fornitore" placeholder="Fornitore Gas" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                                        <input type="number" step="0.01" id="cost-gas-importo" placeholder="Importo €" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                                    </div>
                                    <!-- Acqua -->
                                    <div class="grid grid-cols-2 gap-4 items-end">
                                        <input type="text" id="cost-acqua-fornitore" placeholder="Fornitore Acqua" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                                        <input type="number" step="0.01" id="cost-acqua-importo" placeholder="Importo €" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                                    </div>
                                </div>
                            </div>
    
                            <!-- Sezione Personale -->
                            <div class="bg-gray-800/50 border border-gray-700 rounded-2xl p-6">
                                <h3 class="text-xl font-semibold text-white mb-4">Personale</h3>
                                <div class="space-y-4">
                                    <input type="number" step="0.01" id="cost-personale-buste" placeholder="Costo Totale Buste Paga €" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                                    <input type="number" step="0.01" id="cost-personale-sicurezza" placeholder="Aggiornamento Sicurezza Dipendenti €" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                                </div>
                            </div>
                            
                            <!-- Altre Voci di Costo -->
                             <div class="bg-gray-800/50 border border-gray-700 rounded-2xl p-6 lg:col-span-2">
                                 <h3 class="text-xl font-semibold text-white mb-4">Altre Voci di Costo</h3>
                                 <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <input type="number" step="0.01" id="costo-pulizie" placeholder="Materiali Pulizie €" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                                    <input type="number" step="0.01" id="costo-man-elettricista" placeholder="Manutenzione Elettricista €" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                                    <input type="number" step="0.01" id="costo-man-idraulico" placeholder="Manutenzione Idraulico €" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                                    <input type="number" step="0.01" id="costo-man-caldaia" placeholder="Manutenzione Caldaia/AC €" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                                    <input type="number" step="0.01" id="costo-man-piscina" placeholder="Manutenzione Piscina €" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                                    <input type="number" step="0.01" id="costo-attrezzatura" placeholder="Costo Attrezzatura €" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                                    <input type="number" step="0.01" id="costo-lavanderia" placeholder="Costo Lavanderia €" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                                    <input type="number" step="0.01" id="costo-commercialista" placeholder="Costo Commercialista €" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                                    <input type="number" step="0.01" id="costo-tari" placeholder="Costo TARI €" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                                    <input type="number" step="0.01" id="costo-gestionale" placeholder="Costo Gestionale PC €" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                                    <input type="number" step="0.01" id="costo-preventivi" placeholder="Costo Modulo Preventivi €" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                                    <input type="number" step="0.01" id="costo-marketing" placeholder="Costo Marketing €" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                                    <input type="number" step="0.01" id="costo-ppc" placeholder="Costo Campagne PPC €" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                                    <input type="number" step="0.01" id="costo-telefono" placeholder="Costo Bolletta Telefonica €" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                                    <input type="number" step="0.01" id="costo-ascensore" placeholder="Manutenzione Ascensore €" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                                    <input type="number" step="0.01" id="costo-parcheggio" placeholder="Costo Parcheggio Esterno €" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                                 </div>
                             </div>
    
                        </div>
                    </form>
                </div>

                <!-- Sezione Report (Nascosta) -->
                <div id="content-report" class="hidden">
                    <h2 class="text-3xl font-bold text-white mb-6">Report e Analisi</h2>
                    <div class="bg-gray-800/50 border border-gray-700 rounded-2xl p-8 text-center">
                        <p class="text-gray-400">Questa sezione è in costruzione. A breve qui potrai generare e scaricare i report dettagliati.</p>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- Messaggio di Salvataggio (Toast) -->
    <div id="toast" class="hidden fixed bottom-8 right-8 bg-green-500 text-white py-3 px-6 rounded-lg shadow-lg">
        Dati salvati con successo!
    </div>

    <!-- Script di Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  const firebaseConfig = {
  apiKey: "AIzaSyCJUsp6HVm8Qf_GepXttxC4CE7oBtWjf5k",
  authDomain: "revenuesentry.firebaseapp.com",
  projectId: "revenuesentry",
  storageBucket: "revenuesentry.firebasestorage.app",
  messagingSenderId: "833757769470",
  appId: "1:833757769470:web:f89fe6022ab7b953e33faf",
  measurementId: "G-YKZ1BR54H0"
};

        
        if (firebaseConfig.apiKey === "LE_TUE_CREDENZIALI") {
            alert("ERRORE: Le credenziali di Firebase non sono state configurate. Incolla le tue credenziali nel file dashboard.html.");
        }

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Elementi del DOM
        const loader = document.getElementById('loader');
        const dashboardContent = document.getElementById('dashboard-content');
        const logoutButton = document.getElementById('logout-button');
        const hotelNameDisplay = document.getElementById('hotel-name-display');
        const costsForm = document.getElementById('costs-form');
        const saveButton = document.getElementById('save-button');
        const toast = document.getElementById('toast');
        
        // Elementi per la navigazione a schede
        const navLinks = document.querySelectorAll('.nav-link');
        const contentSections = {
            panoramica: document.getElementById('content-panoramica'),
            costi: document.getElementById('content-costi'),
            report: document.getElementById('content-report')
        };
        const activeClasses = ['bg-blue-500/20', 'text-blue-300'];
        const inactiveClasses = ['text-gray-400', 'hover:bg-gray-700/50', 'hover:text-white'];


        // Funzione per mostrare il toast
        const showToast = () => {
            toast.classList.remove('hidden', 'toast-exit', 'toast-exit-active');
            toast.classList.add('toast-enter', 'toast-enter-active');
            setTimeout(() => {
                toast.classList.remove('toast-enter', 'toast-enter-active');
                toast.classList.add('toast-exit', 'toast-exit-active');
                 setTimeout(() => toast.classList.add('hidden'), 300);
            }, 3000);
        };
        
        // Genera campi per la ristorazione
        const ristorazioneContainer = document.getElementById('ristorazione-fields');
        for (let i = 1; i <= 20; i++) {
            const fieldHTML = `
                <div class="grid grid-cols-2 gap-4 items-end">
                    <input type="text" id="ristorazione-${i}-fornitore" placeholder="Fornitore Ristorazione ${i}" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                    <input type="number" step="0.01" id="ristorazione-${i}-importo" placeholder="Importo €" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                </div>
            `;
            ristorazioneContainer.innerHTML += fieldHTML;
        }
        
        // Funzione per mostrare una sezione della dashboard
        const showSection = (sectionName) => {
            Object.values(contentSections).forEach(section => section.classList.add('hidden'));
            navLinks.forEach(link => {
                link.classList.remove(...activeClasses);
                link.classList.add(...inactiveClasses);
            });
            if (contentSections[sectionName]) {
                contentSections[sectionName].classList.remove('hidden');
            }
            const activeLink = document.getElementById(`nav-${sectionName}`);
            if (activeLink) {
                activeLink.classList.remove(...inactiveClasses);
                activeLink.classList.add(...activeClasses);
            }
        };

        // Aggiungi event listener ai link di navigazione
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const sectionName = link.id.split('-')[1]; // es. da "nav-costi" a "costi"
                showSection(sectionName);
            });
        });


        // Controlla lo stato dell'autenticazione
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const userDocRef = doc(db, "users", user.uid);
                
                try {
                    const userDocSnap = await getDoc(userDocRef);
                    if (userDocSnap.exists()) {
                        const userData = userDocSnap.data();
                        hotelNameDisplay.textContent = userData.hotelName || 'Mio Hotel';
                        if (userData.costs) {
                            populateForm(userData.costs);
                        }
                    } else {
                        hotelNameDisplay.textContent = 'Hotel non trovato';
                    }
                } catch (error) {
                    console.error("Errore nel recuperare i dati utente:", error);
                    hotelNameDisplay.textContent = 'Errore Dati';
                }

                loader.classList.add('hidden');
                dashboardContent.classList.remove('hidden');
            } else {
                const loginUrl = `${window.location.origin}/login.html`;
                window.location.href = loginUrl;
            }
        });

        // Gestione del logout
        logoutButton.addEventListener('click', () => signOut(auth).catch(err => console.error(err)));

        // Gestione salvataggio costi
        costsForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const user = auth.currentUser;
            if (!user) return;

            saveButton.disabled = true;
            saveButton.textContent = 'Salvataggio...';

            const costsData = {
                ristorazione: [],
                utenze: {
                    energia: { fornitore: document.getElementById('cost-energia-fornitore').value, importo: parseFloat(document.getElementById('cost-energia-importo').value) || 0 },
                    gas: { fornitore: document.getElementById('cost-gas-fornitore').value, importo: parseFloat(document.getElementById('cost-gas-importo').value) || 0 },
                    acqua: { fornitore: document.getElementById('cost-acqua-fornitore').value, importo: parseFloat(document.getElementById('cost-acqua-importo').value) || 0 },
                },
                personale: {
                    bustePaga: parseFloat(document.getElementById('cost-personale-buste').value) || 0,
                    sicurezza: parseFloat(document.getElementById('cost-personale-sicurezza').value) || 0,
                },
                altriCosti: {
                    pulizie: parseFloat(document.getElementById('costo-pulizie').value) || 0,
                    manElettricista: parseFloat(document.getElementById('costo-man-elettricista').value) || 0,
                    manIdraulico: parseFloat(document.getElementById('costo-man-idraulico').value) || 0,
                    manCaldaia: parseFloat(document.getElementById('costo-man-caldaia').value) || 0,
                    manPiscina: parseFloat(document.getElementById('costo-man-piscina').value) || 0,
                    attrezzatura: parseFloat(document.getElementById('costo-attrezzatura').value) || 0,
                    lavanderia: parseFloat(document.getElementById('costo-lavanderia').value) || 0,
                    commercialista: parseFloat(document.getElementById('costo-commercialista').value) || 0,
                    tari: parseFloat(document.getElementById('costo-tari').value) || 0,
                    gestionale: parseFloat(document.getElementById('costo-gestionale').value) || 0,
                    preventivi: parseFloat(document.getElementById('costo-preventivi').value) || 0,
                    marketing: parseFloat(document.getElementById('costo-marketing').value) || 0,
                    ppc: parseFloat(document.getElementById('costo-ppc').value) || 0,
                    telefono: parseFloat(document.getElementById('costo-telefono').value) || 0,
                    ascensore: parseFloat(document.getElementById('costo-ascensore').value) || 0,
                    parcheggio: parseFloat(document.getElementById('costo-parcheggio').value) || 0,
                }
            };
            
            for (let i = 1; i <= 20; i++) {
                const fornitore = document.getElementById(`ristorazione-${i}-fornitore`).value;
                const importo = parseFloat(document.getElementById(`ristorazione-${i}-importo`).value) || 0;
                if(fornitore || importo > 0) {
                    costsData.ristorazione.push({ fornitore, importo });
                }
            }

            try {
                const userDocRef = doc(db, "users", user.uid);
                await setDoc(userDocRef, { costs: costsData }, { merge: true });
                showToast();
            } catch (error) {
                console.error("Errore nel salvataggio dei costi:", error);
                alert("Si è verificato un errore durante il salvataggio. Riprova.");
            } finally {
                saveButton.disabled = false;
                saveButton.textContent = 'Salva Modifiche';
            }
        });
        
        // Funzione per popolare il form con i dati caricati
        function populateForm(costs) {
            if (!costs) return;

            // Popola ristorazione
            if (costs.ristorazione) {
                costs.ristorazione.forEach((item, index) => {
                    if (index < 20) {
                        document.getElementById(`ristorazione-${index + 1}-fornitore`).value = item.fornitore || '';
                        document.getElementById(`ristorazione-${index + 1}-importo`).value = item.importo || '';
                    }
                });
            }

            // Popola utenze
            if (costs.utenze) {
                document.getElementById('cost-energia-fornitore').value = costs.utenze.energia?.fornitore || '';
                document.getElementById('cost-energia-importo').value = costs.utenze.energia?.importo || '';
                document.getElementById('cost-gas-fornitore').value = costs.utenze.gas?.fornitore || '';
                document.getElementById('cost-gas-importo').value = costs.utenze.gas?.importo || '';
                document.getElementById('cost-acqua-fornitore').value = costs.utenze.acqua?.fornitore || '';
                document.getElementById('cost-acqua-importo').value = costs.utenze.acqua?.importo || '';
            }

            // Popola personale
            if (costs.personale) {
                document.getElementById('cost-personale-buste').value = costs.personale.bustePaga || '';
                document.getElementById('cost-personale-sicurezza').value = costs.personale.sicurezza || '';
            }
            
            // Popola altri costi
            if(costs.altriCosti) {
                 for (const [key, value] of Object.entries(costs.altriCosti)) {
                    // Converte camelCase (es. manElettricista) in kebab-case (es. man-elettricista)
                    const idKey = key.replace(/[A-Z]/g, letter => `-${letter.toLowerCase()}`);
                    const element = document.getElementById(`costo-${idKey}`);
                    if (element) {
                        element.value = value || '';
                    }
                }
            }
        }

    </script>
</body>
</html>

